#include "Win.h" 

#include "WindowsMessageLogger.h"

#include <string>
#include <sstream>
#include <iomanip>

#define WM_UAHDESTROYWINDOW 0x0090
#define WM_UAHDRAWMENU 0x0091
#define WM_UAHDRAWMENUITEM 0x0092
#define WM_UAHINITMENU 0x0093
#define WM_UAHMEASUREMENUITEM 0x0094
#define WM_UAHNCPAINTMENUPOPUP 0x0095

#define WIN_MSG_ID(msg){msg, #msg}

WindowsMessageLogger::WindowsMessageLogger()
	:
	map({
			WIN_MSG_ID(WM_NULL),
			WIN_MSG_ID(WM_CREATE),
			WIN_MSG_ID(WM_DESTROY),
			WIN_MSG_ID(WM_MOVE),
			WIN_MSG_ID(WM_SIZE),
			WIN_MSG_ID(WM_ACTIVATE),
			WIN_MSG_ID(WM_SETFOCUS),
			WIN_MSG_ID(WM_KILLFOCUS),
			WIN_MSG_ID(WM_ENABLE),
			WIN_MSG_ID(WM_SETREDRAW),
			WIN_MSG_ID(WM_SETTEXT),
			WIN_MSG_ID(WM_GETTEXT),
			WIN_MSG_ID(WM_GETTEXTLENGTH),
			WIN_MSG_ID(WM_PAINT),
			WIN_MSG_ID(WM_CLOSE),
			WIN_MSG_ID(WM_QUERYENDSESSION),
			WIN_MSG_ID(WM_QUERYOPEN),
			WIN_MSG_ID(WM_ENDSESSION),
			WIN_MSG_ID(WM_QUIT),
			WIN_MSG_ID(WM_ERASEBKGND),
			WIN_MSG_ID(WM_SYSCOLORCHANGE),
			WIN_MSG_ID(WM_SHOWWINDOW),
			WIN_MSG_ID(WM_WININICHANGE),
			WIN_MSG_ID(WM_SETTINGCHANGE),
			WIN_MSG_ID(WM_DEVMODECHANGE),
			WIN_MSG_ID(WM_ACTIVATEAPP),
			WIN_MSG_ID(WM_FONTCHANGE),
			WIN_MSG_ID(WM_TIMECHANGE),
			WIN_MSG_ID(WM_CANCELMODE),
			WIN_MSG_ID(WM_SETCURSOR),
			WIN_MSG_ID(WM_MOUSEACTIVATE),
			WIN_MSG_ID(WM_CHILDACTIVATE),
			WIN_MSG_ID(WM_QUEUESYNC),
			WIN_MSG_ID(WM_GETMINMAXINFO),
			WIN_MSG_ID(WM_PAINTICON),
			WIN_MSG_ID(WM_ICONERASEBKGND),
			WIN_MSG_ID(WM_NEXTDLGCTL),
			WIN_MSG_ID(WM_SPOOLERSTATUS),
			WIN_MSG_ID(WM_DRAWITEM),
			WIN_MSG_ID(WM_MEASUREITEM),
			WIN_MSG_ID(WM_DELETEITEM),
			WIN_MSG_ID(WM_VKEYTOITEM),
			WIN_MSG_ID(WM_CHARTOITEM),
			WIN_MSG_ID(WM_SETFONT),
			WIN_MSG_ID(WM_GETFONT),
			WIN_MSG_ID(WM_SETHOTKEY),
			WIN_MSG_ID(WM_GETHOTKEY),
			WIN_MSG_ID(WM_QUERYDRAGICON),
			WIN_MSG_ID(WM_COMPAREITEM),
			WIN_MSG_ID(WM_GETOBJECT),
			WIN_MSG_ID(WM_COMPACTING),
			WIN_MSG_ID(WM_COMMNOTIFY),
			WIN_MSG_ID(WM_WINDOWPOSCHANGING),
			WIN_MSG_ID(WM_WINDOWPOSCHANGED),
			WIN_MSG_ID(WM_POWER),
			WIN_MSG_ID(WM_COPYDATA),
			WIN_MSG_ID(WM_CANCELJOURNAL),
			WIN_MSG_ID(WM_NOTIFY),
			WIN_MSG_ID(WM_INPUTLANGCHANGEREQUEST),
			WIN_MSG_ID(WM_INPUTLANGCHANGE),
			WIN_MSG_ID(WM_TCARD),
			WIN_MSG_ID(WM_HELP),
			WIN_MSG_ID(WM_USERCHANGED),
			WIN_MSG_ID(WM_NOTIFYFORMAT),
			WIN_MSG_ID(WM_CONTEXTMENU),
			WIN_MSG_ID(WM_STYLECHANGING),
			WIN_MSG_ID(WM_STYLECHANGED),
			WIN_MSG_ID(WM_DISPLAYCHANGE),
			WIN_MSG_ID(WM_GETICON),
			WIN_MSG_ID(WM_SETICON),
			WIN_MSG_ID(WM_NCCREATE),
			WIN_MSG_ID(WM_NCDESTROY),
			WIN_MSG_ID(WM_NCCALCSIZE),
			WIN_MSG_ID(WM_NCHITTEST),
			WIN_MSG_ID(WM_NCPAINT),
			WIN_MSG_ID(WM_NCACTIVATE),
			WIN_MSG_ID(WM_GETDLGCODE),
			WIN_MSG_ID(WM_SYNCPAINT),
			WIN_MSG_ID(WM_NCMOUSEMOVE),
			WIN_MSG_ID(WM_NCLBUTTONDOWN),
			WIN_MSG_ID(WM_NCLBUTTONUP),
			WIN_MSG_ID(WM_NCLBUTTONDBLCLK),
			WIN_MSG_ID(WM_NCRBUTTONDOWN),
			WIN_MSG_ID(WM_NCRBUTTONUP),
			WIN_MSG_ID(WM_NCRBUTTONDBLCLK),
			WIN_MSG_ID(WM_NCMBUTTONDOWN),
			WIN_MSG_ID(WM_NCMBUTTONUP),
			WIN_MSG_ID(WM_NCMBUTTONDBLCLK),
			WIN_MSG_ID(WM_NCXBUTTONDOWN),
			WIN_MSG_ID(WM_NCXBUTTONUP),
			WIN_MSG_ID(WM_NCXBUTTONDBLCLK),
			WIN_MSG_ID(WM_INPUT_DEVICE_CHANGE),
			WIN_MSG_ID(WM_INPUT),
			WIN_MSG_ID(WM_KEYFIRST),
			WIN_MSG_ID(WM_KEYDOWN),
			WIN_MSG_ID(WM_KEYUP),
			WIN_MSG_ID(WM_CHAR),
			WIN_MSG_ID(WM_DEADCHAR),
			WIN_MSG_ID(WM_SYSKEYDOWN),
			WIN_MSG_ID(WM_SYSKEYUP),
			WIN_MSG_ID(WM_SYSCHAR),
			WIN_MSG_ID(WM_SYSDEADCHAR),
			WIN_MSG_ID(WM_UNICHAR),
			WIN_MSG_ID(WM_KEYLAST),
			WIN_MSG_ID(WM_KEYLAST),
			WIN_MSG_ID(WM_IME_STARTCOMPOSITION),
			WIN_MSG_ID(WM_IME_ENDCOMPOSITION),
			WIN_MSG_ID(WM_IME_COMPOSITION),
			WIN_MSG_ID(WM_IME_KEYLAST),
			WIN_MSG_ID(WM_INITDIALOG),
			WIN_MSG_ID(WM_COMMAND),
			WIN_MSG_ID(WM_SYSCOMMAND),
			WIN_MSG_ID(WM_TIMER),
			WIN_MSG_ID(WM_HSCROLL),
			WIN_MSG_ID(WM_VSCROLL),
			WIN_MSG_ID(WM_INITMENU),
			WIN_MSG_ID(WM_INITMENUPOPUP),
			WIN_MSG_ID(WM_GESTURE),
			WIN_MSG_ID(WM_GESTURENOTIFY),
			WIN_MSG_ID(WM_MENUSELECT),
			WIN_MSG_ID(WM_MENUCHAR),
			WIN_MSG_ID(WM_ENTERIDLE),
			WIN_MSG_ID(WM_MENURBUTTONUP),
			WIN_MSG_ID(WM_MENUDRAG),
			WIN_MSG_ID(WM_MENUGETOBJECT),
			WIN_MSG_ID(WM_UNINITMENUPOPUP),
			WIN_MSG_ID(WM_MENUCOMMAND),
			WIN_MSG_ID(WM_CHANGEUISTATE),
			WIN_MSG_ID(WM_UPDATEUISTATE),
			WIN_MSG_ID(WM_QUERYUISTATE),
			WIN_MSG_ID(WM_CTLCOLORMSGBOX),
			WIN_MSG_ID(WM_CTLCOLOREDIT),
			WIN_MSG_ID(WM_CTLCOLORLISTBOX),
			WIN_MSG_ID(WM_CTLCOLORBTN),
			WIN_MSG_ID(WM_CTLCOLORDLG),
			WIN_MSG_ID(WM_CTLCOLORSCROLLBAR),
			WIN_MSG_ID(WM_CTLCOLORSTATIC),
			WIN_MSG_ID(WM_MOUSEFIRST),
			WIN_MSG_ID(WM_MOUSEMOVE),
			WIN_MSG_ID(WM_LBUTTONDOWN),
			WIN_MSG_ID(WM_LBUTTONUP),
			WIN_MSG_ID(WM_LBUTTONDBLCLK),
			WIN_MSG_ID(WM_RBUTTONDOWN),
			WIN_MSG_ID(WM_RBUTTONUP),
			WIN_MSG_ID(WM_RBUTTONDBLCLK),
			WIN_MSG_ID(WM_MBUTTONDOWN),
			WIN_MSG_ID(WM_MBUTTONUP),
			WIN_MSG_ID(WM_MBUTTONDBLCLK),
			WIN_MSG_ID(WM_MOUSEWHEEL),
			WIN_MSG_ID(WM_XBUTTONDOWN),
			WIN_MSG_ID(WM_XBUTTONUP),
			WIN_MSG_ID(WM_XBUTTONDBLCLK),
			WIN_MSG_ID(WM_MOUSEHWHEEL),
			WIN_MSG_ID(WM_MOUSELAST),
			WIN_MSG_ID(WM_MOUSELAST),
			WIN_MSG_ID(WM_MOUSELAST),
			WIN_MSG_ID(WM_MOUSELAST),
			WIN_MSG_ID(WM_PARENTNOTIFY),
			WIN_MSG_ID(WM_ENTERMENULOOP),
			WIN_MSG_ID(WM_EXITMENULOOP),
			WIN_MSG_ID(WM_NEXTMENU),
			WIN_MSG_ID(WM_SIZING),
			WIN_MSG_ID(WM_CAPTURECHANGED),
			WIN_MSG_ID(WM_MOVING),
			WIN_MSG_ID(WM_POWERBROADCAST),
			WIN_MSG_ID(WM_DEVICECHANGE),
			WIN_MSG_ID(WM_MDICREATE),
			WIN_MSG_ID(WM_MDIDESTROY),
			WIN_MSG_ID(WM_MDIACTIVATE),
			WIN_MSG_ID(WM_MDIRESTORE),
			WIN_MSG_ID(WM_MDINEXT),
			WIN_MSG_ID(WM_MDIMAXIMIZE),
			WIN_MSG_ID(WM_MDITILE),
			WIN_MSG_ID(WM_MDICASCADE),
			WIN_MSG_ID(WM_MDIICONARRANGE),
			WIN_MSG_ID(WM_MDIGETACTIVE),
			WIN_MSG_ID(WM_MDISETMENU),
			WIN_MSG_ID(WM_ENTERSIZEMOVE),
			WIN_MSG_ID(WM_EXITSIZEMOVE),
			WIN_MSG_ID(WM_DROPFILES),
			WIN_MSG_ID(WM_MDIREFRESHMENU),
			WIN_MSG_ID(WM_POINTERDEVICECHANGE),
			WIN_MSG_ID(WM_POINTERDEVICEINRANGE),
			WIN_MSG_ID(WM_POINTERDEVICEOUTOFRANGE),
			WIN_MSG_ID(WM_TOUCH),
			WIN_MSG_ID(WM_NCPOINTERUPDATE),
			WIN_MSG_ID(WM_NCPOINTERDOWN),
			WIN_MSG_ID(WM_NCPOINTERUP),
			WIN_MSG_ID(WM_POINTERUPDATE),
			WIN_MSG_ID(WM_POINTERDOWN),
			WIN_MSG_ID(WM_POINTERUP),
			WIN_MSG_ID(WM_POINTERENTER),
			WIN_MSG_ID(WM_POINTERLEAVE),
			WIN_MSG_ID(WM_POINTERACTIVATE),
			WIN_MSG_ID(WM_POINTERCAPTURECHANGED),
			WIN_MSG_ID(WM_TOUCHHITTESTING),
			WIN_MSG_ID(WM_POINTERWHEEL),
			WIN_MSG_ID(WM_POINTERHWHEEL),
			WIN_MSG_ID(WM_IME_SETCONTEXT),
			WIN_MSG_ID(WM_IME_NOTIFY),
			WIN_MSG_ID(WM_IME_CONTROL),
			WIN_MSG_ID(WM_IME_COMPOSITIONFULL),
			WIN_MSG_ID(WM_IME_SELECT),
			WIN_MSG_ID(WM_IME_CHAR),
			WIN_MSG_ID(WM_IME_REQUEST),
			WIN_MSG_ID(WM_IME_KEYDOWN),
			WIN_MSG_ID(WM_IME_KEYUP),
			WIN_MSG_ID(WM_MOUSEHOVER),
			WIN_MSG_ID(WM_MOUSELEAVE),
			WIN_MSG_ID(WM_NCMOUSEHOVER),
			WIN_MSG_ID(WM_NCMOUSELEAVE),
			WIN_MSG_ID(WM_WTSSESSION_CHANGE),
			WIN_MSG_ID(WM_TABLET_FIRST),
			WIN_MSG_ID(WM_TABLET_LAST),
			WIN_MSG_ID(WM_CUT),
			WIN_MSG_ID(WM_COPY),
			WIN_MSG_ID(WM_PASTE),
			WIN_MSG_ID(WM_CLEAR),
			WIN_MSG_ID(WM_UNDO),
			WIN_MSG_ID(WM_RENDERFORMAT),
			WIN_MSG_ID(WM_RENDERALLFORMATS),
			WIN_MSG_ID(WM_DESTROYCLIPBOARD),
			WIN_MSG_ID(WM_DRAWCLIPBOARD),
			WIN_MSG_ID(WM_PAINTCLIPBOARD),
			WIN_MSG_ID(WM_VSCROLLCLIPBOARD),
			WIN_MSG_ID(WM_SIZECLIPBOARD),
			WIN_MSG_ID(WM_ASKCBFORMATNAME),
			WIN_MSG_ID(WM_CHANGECBCHAIN),
			WIN_MSG_ID(WM_HSCROLLCLIPBOARD),
			WIN_MSG_ID(WM_QUERYNEWPALETTE),
			WIN_MSG_ID(WM_PALETTEISCHANGING),
			WIN_MSG_ID(WM_PALETTECHANGED),
			WIN_MSG_ID(WM_HOTKEY),
			WIN_MSG_ID(WM_PRINT),
			WIN_MSG_ID(WM_PRINTCLIENT),
			WIN_MSG_ID(WM_APPCOMMAND),
			WIN_MSG_ID(WM_THEMECHANGED),
			WIN_MSG_ID(WM_CLIPBOARDUPDATE),
			WIN_MSG_ID(WM_DWMCOMPOSITIONCHANGED),
			WIN_MSG_ID(WM_DWMNCRENDERINGCHANGED),
			WIN_MSG_ID(WM_DWMCOLORIZATIONCOLORCHANGED),
			WIN_MSG_ID(WM_DWMWINDOWMAXIMIZEDCHANGE),
			WIN_MSG_ID(WM_DWMSENDICONICTHUMBNAIL),
			WIN_MSG_ID(WM_DWMSENDICONICLIVEPREVIEWBITMAP),
			WIN_MSG_ID(WM_GETTITLEBARINFOEX),
			WIN_MSG_ID(WM_HANDHELDFIRST),
			WIN_MSG_ID(WM_HANDHELDLAST),
			WIN_MSG_ID(WM_AFXFIRST),
			WIN_MSG_ID(WM_AFXLAST),
			WIN_MSG_ID(WM_PENWINFIRST),
			WIN_MSG_ID(WM_PENWINLAST),
			WIN_MSG_ID(WM_APP),
			WIN_MSG_ID(WM_USER),
		})
{}

std::wstring WindowsMessageLogger::operator()(DWORD msg, LPARAM lParam, WPARAM wParam) const
{
	constexpr int colWidth = 30;
	const auto i = map.find(msg);

	std::ostringstream oss;
	if (i != map.end())
	{
		oss << std::left << std::setw(colWidth) << i->second << std::right;
	}
	
	else
	{
		std::ostringstream padss;
		padss << "UNKNOWN MESSAGE: 0x" << std::hex << msg;
		oss << std::left << std::setw(colWidth) << padss.str() << std::right;
	}
	oss << "	LPARAM: 0x" << std::hex << std::setfill('0') << std::setw(8) << lParam;
	oss << "	WPARAM: 0x" << std::hex << std::setfill('0') << std::setw(8) << wParam << std::endl;
	
	return SimpleToWstr(oss.str());
}

std::wstring WindowsMessageLogger::SimpleToWstr(const std::string& str)
{
	return std::wstring(str.begin(), str.end());
}

